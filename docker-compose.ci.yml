# CI override for docker-compose.yml
# This removes Loki logging driver dependencies and disables Ollama for CI
# environments where these services are not available.
#
# In CI environments (GitHub Actions):
# - The Loki logging plugin needs to be installed separately
# - Ollama is not available and would cause 30s timeouts
#
# Instead we use:
# - json-file driver (available everywhere)
# - Disable Ollama to use rule-based fallbacks
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.ci.yml build
#   docker compose -f docker-compose.yml -f docker-compose.ci.yml up -d
#   docker compose -f docker-compose.yml -f docker-compose.ci.yml down -v
#
# For local development, continue using:
#   docker compose up -d

services:
  textanalyzer:
    environment:
      - USE_OLLAMA=false
      - OLLAMA_URL=
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  scraper:
    environment:
      - OLLAMA_URL=
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  controller:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  web:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  scheduler:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  prometheus:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
